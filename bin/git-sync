#!/bin/bash

function log {
  echo -e "-----> $@"
}

function prefixed {
  sed -e "s/^/       /"
}

BRANCH=$(git symbolic-ref --short HEAD)
REMOTE=$($(git remote | grep upstream) || echo "origin")
log "Pruning $REMOTE..."
git remote prune $REMOTE | prefixed
log "Merging $REMOTE/$BRANCH locally..."
git fetch $REMOTE | prefixed
git merge $REMOTE/$BRANCH | prefixed
if ! [ $REMOTE = "origin" ]; then
  log "Pushing it to origin/$BRANCH..."
  git push origin $BRANCH | prefixed
fi
log "Removing merged branches..."
branches=$(git branch --merged | grep -v '^*' | grep -v 'master')
for branch in $branches; do
  $ZSH/bin/git-nuke $branch | prefixed
done
$ZSH/bin/git-wtf | prefixed

