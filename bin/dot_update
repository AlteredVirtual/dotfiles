#!/bin/sh
#
# dot_update
#
# `dot_update` handles installation, updates, things like that. Run it
# periodically to make sure you're on the latest and greatest.
export PATH="$(command -p getconf PATH):/usr/local/bin"
export ZSH="$HOME/.dotfiles"

# Update repo
echo "› git update"
git --git-dir="$ZSH/.git" --work-tree="$ZSH" \
  pull --rebase --stat origin "$(git rev-parse --abbrev-ref HEAD)"

# Update submodules
echo "› submodules update"
git --git-dir="$ZSH/.git" --work-tree="$ZSH" \
  submodule update --init --recursive --remote --merge --quiet

# Run all installs
echo "› $ZSH/script/install"
"$ZSH/script/install"

if [ -n "$ZSH_VERSION" ]; then
  echo "› antibody update"
  antibody update
fi

echo "› registering last update"
git config --global dotfiles.lastupdate "$(date +%Y%m%d%H%M)"

echo "› update crontab config"
"$ZSH/script/setup_autoupdate"
